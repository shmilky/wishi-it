var wishiOneTimeBtn='<a id="wishiOneTimeBtn" class="wishiBtn" title="Add item to your Wishi closet" target="_blank"></a>',uploadItemWishiUrl="http://www.wishi.me/app/#/landing/addToCloset",addWishiItButtons=function(){$("img:not(.wishiImg)").unbind("mouseenter.wishiEvent mouseleave.wishiEvent").on("mouseenter.wishiEvent",function(){getImgSrcAndExec(this,function(i,e){e=encodeURIComponent(e);var s=$("#wishiOneTimeBtn");s.css("top",i.offset().top+10+"px"),s.css("left",i.offset().left+10+"px"),i.width()>100&&i.height()>100&&s.css("display","block"),s.attr("href",uploadItemWishiUrl+"?picture_url="+encodeURIComponent(e)+"&pageUrl="+encodeURIComponent(window.location.href))})}).on("mouseleave.wishiEvent",function(){$("#wishiOneTimeBtn").css("display","none")})},addWishiImagesToWindow=function(){var i=$(".wishiImagesRow");$("img").each(function(){getImgSrcAndExec(this,function(e,s){if(presentedImages.indexOf(s)<0){presentedImages.push(s);var t=uploadItemWishiUrl+"?picture_url="+encodeURIComponent(s)+"&pageUrl="+encodeURIComponent(window.location.href),n='<div class="wishiImgThumb"><a class="wishiBtn" title="Add item to your Wishi closet" target="_blank" href="'+t+'"></a><div class="imgWrapper"><img class="wishiImg" src="'+s+'"><div></div>';i.append(n),$(".wishiImgThumb:last").on("mouseenter",function(){$(this).find(".wishiBtn").css("display","block")}).on("mouseleave",function(){$(this).find(".wishiBtn").css("display","none")})}})})},getImgSrcAndExec=function(i,e,s){i=$(i);var t,n=i.attr("srcset");if(n){var o=n.trim().split(" ");o.length>0&&(t=fixImgSrcUrl(o[0]))}if(t||(t=fixImgSrcUrl(i.attr("src"))),t&&t.length>7){var a,d;$("<img/>").attr("src",t).load(function(){this&&(a=this.width,d=this.height),a>100&&d>100&&e(i,t)})}},fixImgSrcUrl=function(i){return i=i.trim(),i.length>3?i.length>4&&"http"==i.substr(0,4)?i:"/"==i[0]&&"/"==i[1]?window.location.protocol+i:"/"==i[0]?window.location.host.href+"/"+i.substr(1,i.length-1):window.location.host.href+"/"+i:!1};$(document).ready(function(){$("body").append($(wishiOneTimeBtn)),window.setTimeout(addWishiItButtons,1e3),$(window).on("hashchange",function(){window.setTimeout(addWishiItButtons,1e3)})}),$(window).scroll(function(){window.setTimeout(addWishiItButtons,1e3)});var presentedImages=[];chrome.runtime.onMessage.addListener(function(i,e,s){if(i&&i.message&&console.log(i.message),s({message:"init wishi view"}),0==$(".closeWishiExtension").length){var t='<div id="wishiItemsCanvas"><div class="topViewHeader"><div class="topViewHeadline">Add items to your closet</div><a href="#" class="closeWishiExtension">X</a></div><div class="wishiImagesRowWrapper"><div class="wishiImagesRow"></div></div></div>',n=$("body"),o=$("html");n.append(t),n.css("overflow-y","hidden"),o.css("overflow-y","hidden"),$(".closeWishiExtension").click(function(i){i.preventDefault(),$("#wishiItemsCanvas").remove(),n.css("overflow-y",""),o.css("overflow-y",""),presentedImages=[]}),addWishiImagesToWindow()}});