var wishiOneTimeBtn='<a id="wishiOneTimeBtn" class="wishiBtn" title="Add item to your Wishi closet" target="_blank"></a>',uploadItemWishiUrl="http://www.wishi.me/app/#/landing/addToCloset";function getWishiUrl(i){var e=uploadItemWishiUrl;e+="?picture_url="+encodeURIComponent(i),e+="&pageUrl="+encodeURIComponent(window.location.href);var t=$("*[itemprop='price']").attr("content");t&&(e+="&item_price="+t);var s=$("*[itemprop='brand'] *[itemprop='name']").text();return s&&"Unbranded"!==s&&(e+="&item_brand="+s),e}var addWishiItButtons=function(){$("img:not(.wishiImg)").unbind("mouseenter.wishiEvent mouseleave.wishiEvent").on("mouseenter.wishiEvent",function(){getImgSrcAndExec(this,function(i,e){e=encodeURIComponent(e);var t=$("#wishiOneTimeBtn");t.css("top",i.offset().top+10+"px"),t.css("left",i.offset().left+10+"px"),i.width()>100&&i.height()>100&&t.css("display","block"),t.attr("href",getWishiUrl(e))})}).on("mouseleave.wishiEvent",function(){$("#wishiOneTimeBtn").css("display","none")})},addWishiImagesToWindow=function(){var i=$(".wishiImagesRow");$("img").each(function(){getImgSrcAndExec(this,function(e,t){if(presentedImages.indexOf(t)<0){presentedImages.push(t);var s='<div class="wishiImgThumb"><a class="wishiBtn" title="Add item to your Wishi closet" target="_blank" href="'+getWishiUrl(t)+'"></a><div class="imgWrapper"><img class="wishiImg" src="'+t+'"><div></div>';i.append(s),$(".wishiImgThumb:last").on("mouseenter",function(){$(this).find(".wishiBtn").css("display","block")}).on("mouseleave",function(){$(this).find(".wishiBtn").css("display","none")})}})})},getImgSrcAndExec=function(i,e,t){var s,n,o,a=(i=$(i)).attr("srcset");if(a){var d=a.trim().split(" ");d.length>0&&(s=fixImgSrcUrl(d[0]))}(s||(s=fixImgSrcUrl(i.attr("src"))),s&&s.length>7)&&$("<img/>").attr("src",s).load(function(){this&&(n=this.width,o=this.height),n>100&&o>100&&e(i,s)})},fixImgSrcUrl=function(i){return(i=i.trim()).length>3&&(i.length>4&&"http"==i.substr(0,4)?i:"/"==i[0]&&"/"==i[1]?window.location.protocol+i:"/"==i[0]?window.location.host.href+"/"+i.substr(1,i.length-1):window.location.host.href+"/"+i)};$(document).ready(function(){$("body").append($(wishiOneTimeBtn)),window.setTimeout(addWishiItButtons,1e3),$(window).on("hashchange",function(){window.setTimeout(addWishiItButtons,1e3)})}),$(window).scroll(function(){window.setTimeout(addWishiItButtons,1e3)});var presentedImages=[];chrome.runtime.onMessage.addListener(function(i,e,t){if(i&&i.message&&console.log(i.message),t({message:"init wishi view"}),0==$(".closeWishiExtension").length){var s=$("body"),n=$("html");s.append('<div id="wishiItemsCanvas"><div class="topViewHeader"><div class="topViewHeadline">Add items to your closet</div><a href="#" class="closeWishiExtension">X</a></div><div class="wishiImagesRowWrapper"><div class="wishiImagesRow"></div></div></div>'),s.css("overflow-y","hidden"),n.css("overflow-y","hidden"),$(".closeWishiExtension").click(function(i){i.preventDefault(),$("#wishiItemsCanvas").remove(),s.css("overflow-y",""),n.css("overflow-y",""),presentedImages=[]}),addWishiImagesToWindow()}});